<!DOCTYPE html>
<!-- This is an example for the data access -->
<html>
  <head>
    <title>Example data access</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <div>please look to the console for the results</div>
    <button id="ReadFilter">ReadFilter</button>
    <button id="Save">Save</button>
    <button id="Load">Load</button>
    <button id="Delete">Delete</button>
<script>
let root='../../';

/* GetObject */
//let datadefID='basket';
//let datadefID='k8loginsearch';
let datadefID='k8rightmembers';
let settingsbasket;
let dat;
let url=root+'masterdata/ProcessData.php?process_action=GetObject&datadefID='+datadefID;
fetch(url).then(function (response){return response.text();})
.then(function(text){
  let obj=JSON.parse(text);
  if(obj.bok){
    settingsbasket=obj.data;
    console.log(settingsbasket);
  }else{
    console.log(obj.error);
  }
}).catch(function (err) {
  console.warn('fetch error ', err);
});

document.addEventListener("click",function(e){
  let el=e.target;
  switch(el.id){
    case "ReadFilter":
      /* ReadFilter */
      url=root+"masterdata/ProcessData.php?process_action=ReadFilter&datadefID="+datadefID;
      fetch(url).then(function (response){return response.text();})
      .then(function(text){
        let obj=JSON.parse(text);
        console.log(obj);
      }).catch(function (err) {
        console.warn('fetch error ', err);
      });
      break;
    case "Save":
      /* Save */
      url=root+settingsbasket.masterdata.url_save;
      dat={'currentID':17,'foreignID':2,'quantity':10,'creatorID':22};
      postData(url,dat).then((obj) => {
        console.log(obj);
      });
      break;
    case "Load":
      /* Load */
      url=root+settingsbasket.masterdata.url_load;
      dat={'keyvalue':14};
      postData(url,dat).then((obj) => {
        console.log(obj);
      });
      break;
    case "Delete":
      /* Delete */
      url=root+settingsbasket.masterdata.url_del;
      dat={'keyvalue':14};
      postData(url,dat).then((obj) => {
        console.log(obj);
      });
      break;
  }
});

async function postData(url = "", data = {}) {
  //console.log(data);
  const response = await fetch(url, {
    method: "POST", // *GET, POST, PUT, DELETE, etc.
    headers: {
      'Accept': 'application/json',
      "Content-Type": "application/json"
    },
    body: JSON.stringify(data), // body data type must match "Content-Type" header
  });
  return response.json(); // parses JSON response into native JavaScript objects  });
}
</script>    
  </body>
</html>
